Basic Step Cycle

- loc and prev_loc are stored on User and Step (not Path)
- prev_npc is stored on User and used by Step (not Walk or Path)

If response present:

Walk() 
Walk._get_user()                            * Walk.user? 
                                            Y 
                                                * user stale?
                                                Y   User() R
                                                N   self.user R
                                            N   User() R

Walk.user.set_location(walk.loc)            user.loc    > user.prev_loc
                                            walk.loc    > user.loc

Walk.user._get_path(user.loc,
                    user.prev_loc
                    walk.repeat)            ** user.path? 
                                            Y    
                                                ### but need to complete path before repeating?
                                                ** is this a repeat?  
                                                Y   user.path   > user.path
                                                    user.loc    > path.loc
                                                    user.prev_loc > path.prev_loc
                                                    user.prev_npc > path.prev_npc
                                                    user.name   > path.username

                                                N   pass
                                                    user.loc    > path.loc
                                                    user.prev_loc > path.prev_loc
                                                    user.prev_npc > path.prev_npc
                                                    user.name   > path.username

                                                ** more steps in the path?
                                                Y   user.loc         > path.loc
                                                    user.prev_loc    > path.prev_loc
                                                    user.prev_npc    > path.prev_npc
                                                    user.path R

                                                N   user.path   + user.completed_paths
                                                    Path()      > user.path
                                                    user.loc         > path.loc
                                                    user.prev_loc    > path.prev_loc
                                                    user.prev_npc    > path.prev_npc
                                                    user.path R

                                            N   
                                                
                                                N   PathChooser().choose()
                                                    Path() > user.path
                                                    user.path R

Walk.user.path.get_step_for_prompt(user.loc,
                                   user.prev_loc,
                                   user.prev_npc)
                                            ** path.step_for_reply? 
                                            Y   path.Block ('need_to_reply')
                                            N   
                                                ** path.step_for_prompt?
                                                Y   
                                                    ** does the step have a preset npc and loc?
                                                    Y
                                                        ** are they here?
                                                        Y   path.step_for_prompt R
                                                        N   path.Block('redirect')

                                                    N   loc      > path.step_for_prompt.loc 
                                                        prev_npc > path.step_for_prompt.prev_npc
                                                        self.step_for_prompt R

                                                N   path._prepare_for_prompt(loc)
                                                        path.steps[0] > path.step_for_prompt 
                                                    ** npc here? (step.get_npc())
                                                    Y   Npc() > step.npc
                                                        (loc_id, step.npc) R 

                                                    N   Npc() > step.npc
                                                        path.Block ('redirect')
                                                        Loc() > step.next_loc_id
                                                        (loc_id, step.npc) R

Walk.user.path._check_for_blocks()  ** are there blocks on this step?
                                    Y   path.block.action R
                                    N   None R

Walk.user.path.step_for_prompt.get_prompt(user.name)            
Walk.user.path.step_for_prompt.get_responder()            

Walk.user.path.prepare_for_reply() [change: finish_prompt()]
OR
Walk.user.path.complete_step()              ** path.step is 2-stage?
                                            Y   path.step_for_prompt > path.step_for_reply 
                                                None > path.step_for_prompt

                                            N   path.step_for_prompt > path.completed_steps
                                                                
R {npc, responder, bg_image, npc_image}

-----------------------------------------------------------------------------------------------

**if response string
Walk.get_reply(response_string, loc)
